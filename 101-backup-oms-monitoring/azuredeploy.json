{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspaceLocation": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
                "description": "Specify the workspace region"
            }
        },
        "workspaceName": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
                "description": "Specify the workspace name"
            }
        }
    },
    "variables": {
        "omsSolutions": {
            "customSolution": {
                "name": "Azure Backup Monitoring Solution",
                "solutionName": "[concat('AzureBackup', '[', parameters('workspaceName'), ']')]",
                "publisher": "Microsoft",
                "displayName": "Azure Backup Monitoring Solution",
                "description": "Monitor and analyze your Backup Vaults",
                "author": "Microsoft"
            }
        }
    },
    "resources": 
    [
        {
            "apiVersion": "2015-11-0",
            "name": "[parameters('workspaceName')]",
            "type": "Microsoft.OperationalInsights/workspaces",
            "location": "[parameters('workspaceLocation')]",
            "resources": [
                {
                    "apiVersion": "2015-11-01",
                    "name": "azurebackup_monitoring_reporting_soln",
                    "type": "Microsoft.Resources/deployments",
                    "location": "[parameters('workspaceLocation')]",
                    "dependsOn": [
                        "[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                    ],
                    "properties":{
                        "mode": "Incremental",
                        "templateLink": {
                            "uri": "https://raw.githubusercontent.com/adityabalaji-msft/azure-quickstart-templates/adbalaji-working-branch/101-backup-oms-monitoring/azurebackup_monitoring_reporting_soln.json",
                            "contentVersion": "1.0.0.0"
                          }
                    }
                },

                {
                    "apiVersion": "2015-11-01",
                     "mode": "Incremental",
                    "name": "backup_jobs_log",
                    "type": "Microsoft.Resources/deployments",
                    "location": "[parameters('workspaceLocation')]",
                    "dependsOn": [
                        "[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                    ],
                    "properties":{
                        "mode": "Incremental",
                        "templateLink": {
                            "uri": "https://raw.githubusercontent.com/adityabalaji-msft/azure-quickstart-templates/adbalaji-working-branch/101-backup-oms-monitoring/backup_jobs_log.json",
                            "contentVersion": "1.0.0.0"
                          }
                    }
                },

                {
                    "apiVersion": "2015-11-01",
                    "name": "backup_jobs_non_log",
                    "type": "Microsoft.Resources/deployments",
                    "location": "[parameters('workspaceLocation')]",
                    "dependsOn": [
                        "[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                    ],
                    "properties":{
                        "mode": "Incremental",
                        "templateLink": {
                            "uri": "https://raw.githubusercontent.com/adityabalaji-msft/azure-quickstart-templates/adbalaji-working-branch/101-backup-oms-monitoring/backup_jobs_non_log.json",
                            "contentVersion": "1.0.0.0"
                          }
                    }
                },

                {
                    "apiVersion": "2015-11-01",
                    "name": "alerts_from_azure_resources",
                    "type": "Microsoft.Resources/deployments",
                    "location": "[parameters('workspaceLocation')]",
                    "dependsOn": [
                        "[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                    ],
                    "properties":{
                        "mode": "Incremental",
                        "templateLink": {
                            "uri": "https://raw.githubusercontent.com/adityabalaji-msft/azure-quickstart-templates/adbalaji-working-branch/101-backup-oms-monitoring/alerts_from_azure_resources.json",
                            "contentVersion": "1.0.0.0"
                          }
                    }
                }


                
            ]
        }
    ]   
}
